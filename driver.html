<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DRIVER AWWABIM</title>

<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
/* --- BASE STYLE --- */
* { box-sizing: border-box; outline: none; }
body {
    margin: 0; padding: 20px 10px;
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #11998e, #38ef7d);
    color: #333;
    min-height: 100vh;
}
.container { max-width: 600px; margin: auto; }

/* --- CARD STYLE --- */
.card {
    background: #fff;
    border-radius: 16px;
    padding: 20px;
    margin-bottom: 15px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    position: relative;
    overflow: hidden;
}
.card.wait { border-left: 6px solid #f1c40f; }
.card.process { border-left: 6px solid #3498db; }
.card.done { border-left: 6px solid #bdc3c7; opacity: 0.9; }

h3 { margin: 0 0 10px 0; font-size: 1.1rem; display: flex; align-items: center; justify-content: space-between; }
p { margin: 5px 0; color: #666; font-size: 14px; }
.big-name { font-size: 18px; font-weight: bold; color: #000; }

input {
    width: 100%; padding: 16px; font-size: 16px;
    border-radius: 12px; border: 2px solid #ddd; margin-bottom: 15px;
}

/* --- BUTTONS --- */
.btn {
    width: 100%; padding: 14px; font-size: 16px;
    border: none; border-radius: 10px; color: #fff;
    font-weight: 600; cursor: pointer; text-align: center;
    margin-top: 10px; display: block; text-decoration: none;
}
.btn-login { background: #27ae60; }
.btn-logout { background: #e74c3c; margin-top: 30px; font-size: 14px; }

/* Grid Tombol WA/Telp */
.action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
.wa { background: #25D366; }
.tel { background: #2980b9; }

.main-action { 
    margin-top: 15px; padding: 16px; font-size: 18px; letter-spacing: 1px;
    text-transform: uppercase;
}
.siap { background: #f39c12; color: #fff; }
.selesai { background: #27ae60; color: #fff; }

/* --- EMPTY STATE (TENGAH LAYAR & TERANG) --- */
.empty-state {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    min-height: 50vh; /* Setengah tinggi layar */
    color: #fff;
    text-shadow: 0 2px 5px rgba(0,0,0,0.2);
}
.empty-icon { font-size: 60px; display: block; margin-bottom: 15px; }
.empty-text { font-size: 20px; font-weight: bold; color: #fff; margin-bottom: 5px; }
.empty-sub { font-size: 14px; color: #f0f0f0; }

/* --- TOAST NOTIFICATION --- */
#toast-box {
    position: fixed; top: 20px; right: 20px; z-index: 9999;
}
.toast {
    background: #333; color: #fff; padding: 12px 20px;
    border-radius: 8px; margin-bottom: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    animation: slideIn 0.3s, fadeOut 0.5s 2.5s forwards;
    font-size: 14px;
}
@keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
@keyframes fadeOut { to { opacity: 0; } }
</style>
</head>

<body>
<div id="toast-box"></div> <div class="container">

    <div class="card" id="loginBox">
        <h3>ðŸ›µ Login Driver</h3>
        <input id="driverName" placeholder="Nama Driver" autocomplete="off">
        <button class="btn btn-login" onclick="doLogin()">MULAI KERJA</button>
    </div>

    <div id="app" style="display:none">
        <div id="listAktif"></div>
        
        <hr style="border:0; border-top:1px dashed rgba(255,255,255,0.5); margin: 30px 0;">
        
        <h4 style="color:#fff; text-align:center; margin-bottom:15px; opacity:0.9">RIWAYAT TERAKHIR</h4>
        <div id="listHistory"></div>

        <button class="btn btn-logout" onclick="logout()">LOGOUT</button>
    </div>

</div>

<script>
// --- CONFIG ---
const firebaseConfig = {
    apiKey: "AIzaSyA-1GyDIS77tlL0vpiZS_ZLvx1S71TnkQU",
    databaseURL: "https://awwabim-laundry-default-rtdb.firebaseio.com"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database().ref("Pesanan");

// --- DOM ---
const loginBox = document.getElementById("loginBox");
const app = document.getElementById("app");
const divAktif = document.getElementById("listAktif");
const divHistory = document.getElementById("listHistory");

// --- UTILS ---
function showToast(msg, color="#27ae60"){
    const box = document.getElementById("toast-box");
    const el = document.createElement("div");
    el.className = "toast";
    el.innerText = msg;
    el.style.background = color;
    box.appendChild(el);
    setTimeout(()=> el.remove(), 3000);
}

// --- LOGIN/LOGOUT ---
function doLogin(){
    const n = document.getElementById("driverName").value.trim();
    if(!n) return showToast("Nama Driver wajib diisi!", "#e74c3c");
    localStorage.setItem("driver", n);
    checkAuth();
}

function checkAuth(){
    if(localStorage.getItem("driver")){
        loginBox.style.display = "none";
        app.style.display = "block";
    }
}
checkAuth();

function logout(){
    localStorage.clear();
    location.reload();
}

// --- LOGIC ---
db.on("value", snap => {
    divAktif.innerHTML = "";
    divHistory.innerHTML = "";

    const dataArray = [];
    snap.forEach(child => {
        dataArray.push({ key: child.key, ...child.val() });
    });
    dataArray.reverse();

    let countAktif = 0;

    dataArray.forEach(d => {
        const time = new Date(d.mulai).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        const driverYgAmbil = d.driverName ? `(${d.driverName})` : "";
        
        if(d.status === "SELESAI"){
            // TAMPILAN HISTORY
            const timeEnd = d.selesai ? new Date(d.selesai).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : "-";
            divHistory.innerHTML += `
            <div class="card done">
                <div style="display:flex; justify-content:space-between; align-items:center">
                    <span style="font-weight:bold; color:#7f8c8d">${d.layanan} ${driverYgAmbil}</span>
                    <small style="color:#95a5a6">${time} - ${timeEnd}</small>
                </div>
                <div class="big-name" style="color:#555">${d.nama}</div>
                <div style="font-size:12px; color:#27ae60; margin-top:5px">âœ… SELESAI</div>
            </div>`;
        } else {
            // TAMPILAN AKTIF
            countAktif++;
            
            let btnMain = "";
            let statusClass = "wait";
            
            if(d.status === "MENUNGGU_DRIVER"){
                // Tombol Ambil Order
                btnMain = `<button class="btn main-action siap" onclick="ambilOrder('${d.key}','${d.layanan}')">ðŸš€ AMBIL ORDER</button>`;
            } else {
                // Tombol Selesai
                statusClass = "process";
                btnMain = `<button class="btn main-action selesai" onclick="selesai('${d.key}')">âœ… SELESAIKAN</button>`;
            }

            const iconLayanan = d.layanan === "ANTAR" ? "ðŸ›µ ANTAR" : "ðŸ§º JEMPUT";

            divAktif.innerHTML += `
            <div class="card ${statusClass}">
                <h3>
                    <span>${iconLayanan}</span>
                    <small style="font-weight:normal; font-size:12px">${time}</small>
                </h3>
                <div class="big-name">${d.nama}</div>
                <p>WhatsApp: ${d.wa}</p>
                <p style="font-size:12px; color:#666">Status: ${d.status.replace("_"," ")} ${driverYgAmbil}</p>
                
                <div class="action-grid">
                    <a class="btn wa" href="https://wa.me/${d.wa}" target="_blank">ðŸ’¬ CHAT</a>
                    <a class="btn tel" href="tel:${d.wa}">ðŸ“ž TELEPON</a>
                </div>
                ${btnMain}
            </div>`;
        }
    });

    // EMPTY STATE (Tampilan Tengah & Terang)
    if(countAktif === 0){
        divAktif.innerHTML = `
        <div class="empty-state">
            <span class="empty-icon">â˜•</span>
            <div class="empty-text">BELUM ADA PESANAN</div>
            <div class="empty-sub">Santai sejenak bro...</div>
        </div>`;
    }
    
    if(!divHistory.innerHTML){
        divHistory.innerHTML = `<div style="text-align:center; color:#fff; opacity:0.7">Belum ada riwayat</div>`;
    }
});

function ambilOrder(key, layanan){
    const drvName = localStorage.getItem("driver");
    const newStatus = layanan === "ANTAR" ? "SEDANG_DIANTAR" : "SEDANG_DIJEMPUT";
    
    // Update ke Firebase (Simpan Nama Driver)
    db.child(key).update({ 
        status: newStatus,
        driverName: drvName
    });

    showToast("Langsung OTW! ðŸš€", "#f39c12");
}

function selesai(key){
    // Langsung eksekusi tanpa confirm
    db.child(key).update({
        status: "SELESAI",
        selesai: firebase.database.ServerValue.TIMESTAMP
    });

    showToast("Pekerjaan Selesai! Alhamdulillah ðŸ¤²", "#27ae60");
}
</script>
</body>
</html>
