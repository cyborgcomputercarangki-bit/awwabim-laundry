<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Driver Laundry</title>

<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>

<style>
body{margin:0;font-family:Segoe UI;background:#f2f2f2}
.container{max-width:1000px;margin:auto;padding:10px}
.card{background:#fff;padding:12px;border-radius:10px;margin-bottom:10px}
input,button{
 width:100%;
 padding:12px;
 margin-bottom:8px;
 border-radius:8px;
 border:1px solid #ccc
}
button{border:none;font-weight:bold;color:#fff}
.btn-login{background:#27ae60}
.btn-selesai{background:#e74c3c}
.btn-chat{background:#0984e3}

.toast{
 position:fixed;
 bottom:20px;
 right:20px;
 background:#333;
 color:#fff;
 padding:12px 16px;
 border-radius:8px;
 display:none;
 z-index:9999;
}
</style>
</head>

<body>
<div class="container">

<!-- LOGIN -->
<div class="card" id="loginBox">
 <h3>Login Driver</h3>
 <input id="driverName" placeholder="Nama Driver">
 <button class="btn-login" onclick="loginDriver()">MASUK</button>
</div>

<!-- APP -->
<div id="app" style="display:none"></div>

<div id="toast" class="toast"></div>

</div>

<script>
firebase.initializeApp({
 apiKey:"AIzaSyA-1GyDIS77tlL0vpiZS_ZLvx1S71TnkQU",
 databaseURL:"https://awwabim-laundry-default-rtdb.firebaseio.com"
});
const db = firebase.database().ref("Pesanan");

let driver = "";
let lastCount = 0;

function toast(msg){
 const t = document.getElementById("toast");
 t.innerText = msg;
 t.style.display = "block";
 setTimeout(()=>t.style.display="none",3000);
}

function loginDriver(){
 driver = document.getElementById("driverName").value.trim();
 if(!driver){
  toast("âŒ Nama driver wajib diisi");
  return;
 }
 document.getElementById("loginBox").style.display = "none";
 document.getElementById("app").style.display = "block";
 toast("ðŸ‘‹ Selamat bekerja, " + driver);
}

db.on("value", snap=>{
 let count = 0;
 let html = "";
 snap.forEach(c=>{
  const d = c.val();
  if(d.status === "SELESAI") return;
  count++;

  let btn = "";
  if(d.status !== "SEDANG_DICUCI"){
   btn = `<button class="btn-selesai"
           onclick="selesai('${c.key}','${d.layanan}')">
           SELESAI
          </button>`;
  }

  html += `
   <div class="card">
    <b>${d.nama}</b><br>
    ðŸ›µ ${d.layanan}<br>
    Status: <b>${d.status}</b><br><br>
    ${btn}
    <a href="https://wa.me/${d.wa}" target="_blank">
     <button class="btn-chat">CHAT</button>
    </a>
   </div>
  `;
 });

 document.getElementById("app").innerHTML = html;

 if(count > lastCount){
  toast("ðŸ“¥ Pesanan baru masuk");
 }
 lastCount = count;
});

function selesai(id, layanan){
 if(layanan === "JEMPUT"){
  db.child(id).update({
   status: "SEDANG_DICUCI",
   driver: driver
  });
  toast("ðŸ§º Jemput selesai â†’ Proses cuci");
 } else {
  db.child(id).update({
   status: "SELESAI",
   driver: driver
  });
  toast("âœ… Antar selesai");
 }
}
</script>
</body>
</html>
