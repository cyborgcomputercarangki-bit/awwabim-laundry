<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DRIVER AWWABIM LAUNDRY</title>

<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>

<style>
body{font-family:Segoe UI;background:#dfe6e9;margin:0}
.container{max-width:800px;margin:auto;background:#fff;padding:15px;border-radius:10px}
input,button{padding:10px;border-radius:6px;border:1px solid #ccc;width:100%}
button{background:#27ae60;color:#fff;font-weight:bold;border:none}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{padding:8px;border-bottom:1px solid #eee}
th{background:#0984e3;color:#fff}
</style>
</head>

<body>
<div class="container">

<h3>ðŸšš DRIVER AWWABIM LAUNDRY</h3>

<div id="login">
 <input id="namaDriver" placeholder="Nama driver">
 <button onclick="login()">MASUK</button>
</div>

<div id="app" style="display:none">
 <p>Login sebagai: <b id="driverName"></b></p>
 <button onclick="logout()" style="background:#e74c3c">LOGOUT</button>

 <table>
 <thead>
 <tr><th>Pelanggan</th><th>Layanan</th><th>Aksi</th></tr>
 </thead>
 <tbody id="list"></tbody>
 </table>
</div>

</div>

<script>
firebase.initializeApp({
 apiKey:"AIzaSyA-1GyDIS77tlL0vpiZS_ZLvx1S71TnkQU",
 databaseURL:"https://awwabim-laundry-default-rtdb.firebaseio.com/"
});

const db = firebase.database().ref("pesanan");
const notif = firebase.database().ref("notifikasi");

let driver = localStorage.getItem("driver");

/* LOGIN */
function login(){
 let nama=document.getElementById("namaDriver").value;
 if(!nama) return alert("Nama wajib diisi");
 localStorage.setItem("driver",nama);
 location.reload();
}

/* LOGOUT */
function logout(){
 localStorage.removeItem("driver");
 location.reload();
}

if(driver){
 document.getElementById("login").style.display="none";
 document.getElementById("app").style.display="block";
 document.getElementById("driverName").innerText=driver;
}

/* LIST PESANAN */
db.on("value", snap=>{
 let html="";
 snap.forEach(d=>{
  let v=d.val();
  if(v.status==="MENUNGGU" && v.driver===driver){
   html+=`
   <tr>
    <td>${v.nama}</td>
    <td>${v.layanan}</td>
    <td><button onclick="selesai('${d.key}')">SELESAI</button></td>
   </tr>`;
  }
 });
 list.innerHTML=html||"<tr><td colspan=3>Tidak ada pesanan</td></tr>";
});

/* SELESAI */
function selesai(id){
 db.child(id).update({status:"SELESAI"});
 notif.push({
  dari:driver,
  ke:"ADMIN",
  pesan:"Pesanan sudah selesai",
  waktu:Date.now(),
  dibaca:false
 });
}

/* NOTIF DARI ADMIN */
notif.on("child_added", snap=>{
 let n=snap.val();
 if(n.ke===driver && !n.dibaca){
  alert("ðŸ”” "+n.pesan);
  snap.ref.update({dibaca:true});
 }
});
</script>

</body>
</html>
