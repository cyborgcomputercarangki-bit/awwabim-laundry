<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Awwabim Laundry - Admin</title>

<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>

<style>
/* ===== UI ASLI KAMU (TIDAK DIUBAH) ===== */
body{
    margin:0;
    font-family:Segoe UI,Arial;
    background:linear-gradient(135deg,#fceabb,#f8b500);
}
.container{
    max-width:1000px;
    margin:auto;
    background:#fff;
    padding:15px;
    border-radius:12px;
    box-shadow:0 6px 15px rgba(0,0,0,.2);
}
h1{margin:0;color:#2c3e50}
nav{display:flex;gap:10px;margin:15px 0}
nav button{
    flex:1;padding:10px;border:none;border-radius:6px;
    font-weight:bold;background:#ecf0f1
}
nav button.active{background:#e67e22;color:#fff}
section{display:none}
section.active{display:block}
input{
    width:100%;padding:12px;margin-bottom:10px;
    border-radius:6px;border:1px solid #ccc
}
.btn{padding:12px;border:none;border-radius:6px;font-weight:bold;color:#fff}
.btn-jemput{background:#27ae60}
.btn-antar{background:#3498db}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{padding:8px;border-bottom:1px solid #ddd;text-align:center}
th{background:#2c3e50;color:#fff}
.status{padding:5px 10px;border-radius:20px;font-size:12px;font-weight:bold}
.MENUNGGU_DRIVER{background:#f39c12}
.PROSES_CUCI{background:#e74c3c;color:#fff}
.PROSES_ANTAR{background:#3498db;color:#fff}
.SELESAI{background:#27ae60;color:#fff}
.toast{
    position:fixed;bottom:20px;right:20px;
    background:#333;color:#fff;
    padding:15px;border-radius:8px;
    display:none;z-index:9999
}

/* LOGIN */
#loginBox{
    position:fixed;inset:0;
    background:rgba(0,0,0,.6);
    display:flex;align-items:center;justify-content:center;
}
#loginBox div{
    background:#fff;padding:20px;border-radius:10px;width:300px;
}
</style>
</head>

<body>

<!-- LOGIN ADMIN -->
<div id="loginBox">
  <div>
    <h3>Login Admin</h3>
    <input id="namaAdmin" placeholder="Nama admin">
    <button class="btn btn-antar" onclick="login()">MASUK</button>
  </div>
</div>

<div class="container">
    <h1>ðŸ§º Awwabim Laundry â€“ ADMIN</h1>

    <nav>
        <button class="active" onclick="openTab('input')">Order Baru</button>
        <button onclick="openTab('aktif')">Pesanan Aktif</button>
    </nav>

    <section id="input" class="active">
        <input id="nama" placeholder="Nama Pelanggan">
        <input id="wa" placeholder="WhatsApp (08xxx)">
        <input id="driver" placeholder="Nama Driver">
        <button class="btn btn-jemput" onclick="submitPesanan('JEMPUT')">ðŸ§º JEMPUT</button>
        <br><br>
        <button class="btn btn-antar" onclick="submitPesanan('ANTAR')">ðŸšš ANTAR</button>
    </section>

    <section id="aktif">
        <table>
            <thead>
                <tr>
                    <th>Waktu</th>
                    <th>Nama</th>
                    <th>Layanan</th>
                    <th>Status</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody id="list"></tbody>
        </table>
    </section>
</div>

<div id="toast" class="toast"></div>

<script>
/* ========== FIREBASE ========== */
firebase.initializeApp({
 apiKey:"AIzaSyA-1GyDIS77tlL0vpiZS_ZLvx1S71TnkQU",
 databaseURL:"https://awwabim-laundry-default-rtdb.firebaseio.com"
});
const db=firebase.database();
const Pesanan=db.ref("Pesanan");
const Notif=db.ref("Notifikasi");

/* ========== LOGIN ========== */
let admin=localStorage.getItem("admin");
if(admin) document.getElementById("loginBox").style.display="none";

function login(){
 let n=document.getElementById("namaAdmin").value.trim();
 if(!n) return alert("Nama wajib diisi");
 localStorage.setItem("admin",n);
 location.reload();
}

/* ========== UI ========== */
function openTab(id){
 document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
 document.getElementById(id).classList.add("active");
 document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
 event.target.classList.add("active");
}
function toast(msg){
 const t=document.getElementById("toast");
 t.innerText=msg;
 t.style.display="block";
 setTimeout(()=>t.style.display="none",3000);
}

/* ========== SUBMIT + NOTIF DRIVER ========== */
function submitPesanan(layanan){
 const nama=document.getElementById("nama").value.trim();
 const wa=document.getElementById("wa").value.trim();
 const driver=document.getElementById("driver").value.trim();
 if(!nama||!wa||!driver) return toast("âŒ Lengkapi data");

 const ref=Pesanan.push();
 ref.set({
  id:ref.key,
  namaPelanggan:nama,
  kontakWa:wa,
  driver,
  tipeLayanan:layanan,
  status:"MENUNGGU_DRIVER",
  timestamp:Date.now()
 });

 Notif.push({
  dari:"ADMIN",
  ke:driver,
  pesan:`Order ${layanan} - ${nama}`,
  waktu:Date.now(),
  dibaca:false
 });

 toast("âœ… Order & notifikasi terkirim");
}

/* ========== STATUS NEXT + NOTIF ADMIN ========== */
function nextStatus(id,st){
 let ns="SELESAI";
 if(st==="MENUNGGU_DRIVER") ns="PROSES_CUCI";
 else if(st==="PROSES_CUCI") ns="PROSES_ANTAR";

 Pesanan.child(id).update({status:ns});
}

/* ========== LIST ========== */
Pesanan.on("value",snap=>{
 list.innerHTML="";
 snap.forEach(c=>{
  const d=c.val();
  if(d.status==="SELESAI") return;
  list.innerHTML+=`
  <tr>
   <td>${new Date(d.timestamp).toLocaleTimeString()}</td>
   <td>${d.namaPelanggan}</td>
   <td>${d.tipeLayanan}</td>
   <td><span class="status ${d.status}">${d.status}</span></td>
   <td><button onclick="nextStatus('${c.key}','${d.status}')">Next</button></td>
  </tr>`;
 });
});

/* ========== NOTIF DARI DRIVER ========== */
Notif.on("child_added",snap=>{
 const n=snap.val();
 if(n.ke==="ADMIN" && !n.dibaca){
  toast("ðŸ”” Driver: "+n.pesan);
  snap.ref.update({dibaca:true});
 }
});
</script>
</body>
</html>
