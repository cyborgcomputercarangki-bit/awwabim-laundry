<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Awwabim Laundry - Admin</title>

<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>

<style>
body{
 margin:0;font-family:Segoe UI;
 background:linear-gradient(135deg,#fceabb,#f8b500)
}
.container{
 max-width:1000px;margin:auto;background:#fff;
 padding:15px;border-radius:12px
}
h2{margin-top:0}

/* LOGIN */
#loginBox{
 max-width:400px;margin:60px auto;
 background:#fff;padding:20px;border-radius:10px;
 box-shadow:0 4px 10px rgba(0,0,0,.2)
}
#loginBox input{
 width:100%;padding:12px;margin-bottom:10px
}
#loginBox button{
 width:100%;padding:12px;border:none;
 background:#27ae60;color:#fff;
 font-weight:bold;border-radius:6px
}

/* DASHBOARD */
#dashboard{display:none}

nav{display:flex;gap:10px;margin:15px 0}
nav button{
 flex:1;padding:10px;border:none;
 border-radius:6px;font-weight:bold
}
nav button.active{background:#e67e22;color:#fff}

section{display:none}
section.active{display:block}

input{width:100%;padding:10px;margin-bottom:10px}

table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid #ddd;text-align:center}
th{background:#2c3e50;color:#fff}

.status{
 padding:5px 10px;border-radius:20px;
 font-size:12px;color:#fff
}
.MENUNGGU_DRIVER{background:#f39c12}
.PROSES_CUCI{background:#e74c3c}
.PROSES_ANTAR{background:#3498db}
.SELESAI{background:#27ae60}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox">
 <h2>üîê Login Admin</h2>
 <input id="adminNameInput" placeholder="Nama Admin">
 <button onclick="loginAdmin()">LOGIN</button>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="container">
 <h2>üß∫ ADMIN AWWABIM LAUNDRY</h2>
 <p>Login sebagai: <b id="adminName"></b></p>

 <nav>
  <button id="tabInput" class="active">Order Baru</button>
  <button id="tabAktif">Pesanan Aktif</button>
  <button id="tabHistory">History</button>
 </nav>

 <!-- ORDER BARU -->
 <section id="input" class="active">
  <input id="nama" placeholder="Nama Pelanggan">
  <input id="wa" placeholder="WhatsApp">
  <button onclick="submitPesanan('JEMPUT')">üß∫ JEMPUT</button><br><br>
  <button onclick="submitPesanan('ANTAR')">üöö ANTAR</button>
 </section>

 <!-- AKTIF -->
 <section id="aktif">
  <table>
   <thead>
    <tr>
     <th>Waktu</th>
     <th>Pelanggan</th>
     <th>Layanan</th>
     <th>Driver</th>
     <th>Status</th>
     <th>Aksi</th>
    </tr>
   </thead>
   <tbody id="listAktif"></tbody>
  </table>
 </section>

 <!-- HISTORY -->
 <section id="history">
  <table>
   <thead>
    <tr>
     <th>Waktu</th>
     <th>Pelanggan</th>
     <th>Layanan</th>
     <th>Driver</th>
     <th>Status</th>
    </tr>
   </thead>
   <tbody id="listHistory"></tbody>
  </table>
 </section>
</div>

<script>
/* ===== FIREBASE ===== */
firebase.initializeApp({
 apiKey:"AIzaSyA-1GyDIS77tlL0vpiZS_ZLvx1S71TnkQU",
 databaseURL:"https://awwabim-laundry-default-rtdb.firebaseio.com"
});
const Pesanan = firebase.database().ref("Pesanan");

/* ===== DOM ===== */
const loginBox=document.getElementById("loginBox");
const dashboard=document.getElementById("dashboard");
const adminName=document.getElementById("adminName");

/* ===== LOGIN ===== */
function loginAdmin(){
 const n=document.getElementById("adminNameInput").value.trim();
 if(!n) return alert("Nama admin wajib diisi");
 adminName.innerText=n;
 loginBox.style.display="none";
 dashboard.style.display="block";
}

/* ===== TAB ===== */
function openTab(id){
 document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
 document.getElementById(id).classList.add("active");
 document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
 document.getElementById("tab"+id.charAt(0).toUpperCase()+id.slice(1)).classList.add("active");
}
tabInput.onclick=()=>openTab("input");
tabAktif.onclick=()=>openTab("aktif");
tabHistory.onclick=()=>openTab("history");

/* ===== SUBMIT ===== */
function submitPesanan(layanan){
 const n=nama.value.trim();
 let w=wa.value.replace(/\D/g,'');
 if(!n||!w) return alert("Lengkapi data");
 if(w.startsWith("0")) w="62"+w.slice(1);

 Pesanan.push({
  namaPelanggan:n,
  kontakWa:w,
  tipeLayanan:layanan,
  status:"MENUNGGU_DRIVER",
  driver:null,
  timestamp:Date.now()
 });

 nama.value=""; wa.value="";
}

/* ===== LIST ===== */
Pesanan.on("value",snap=>{
 listAktif.innerHTML="";
 listHistory.innerHTML="";
 snap.forEach(c=>{
  const d=c.val();
  const jam=new Date(d.timestamp).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"});
  if(d.status==="SELESAI"){
   listHistory.innerHTML+=`
   <tr>
    <td>${jam}</td>
    <td>${d.namaPelanggan}</td>
    <td>${d.tipeLayanan}</td>
    <td>${d.driver||"-"}</td>
    <td><span class="status SELESAI">SELESAI</span></td>
   </tr>`;
  }else{
   listAktif.innerHTML+=`
   <tr>
    <td>${jam}</td>
    <td>${d.namaPelanggan}</td>
    <td>${d.tipeLayanan}</td>
    <td>${d.driver||"-"}</td>
    <td><span class="status ${d.status}">${d.status}</span></td>
    <td>
     <button onclick="Pesanan.child('${c.key}').update({status:'SELESAI'})">
      Selesai
     </button>
    </td>
   </tr>`;
  }
 });
});
</script>
</body>
</html>
