<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ADMIN AWWABIM LAUNDRY</title>

<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>

<style>
body{font-family:Segoe UI;background:#f5f6fa;margin:0}
.container{max-width:900px;margin:auto;background:#fff;padding:15px;border-radius:10px}
input,button{padding:10px;border-radius:6px;border:1px solid #ccc;width:100%}
button{background:#27ae60;color:#fff;font-weight:bold;border:none}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{padding:8px;border-bottom:1px solid #eee}
th{background:#2c3e50;color:#fff}
</style>
</head>

<body>
<div class="container">

<h3>ðŸ‘‘ ADMIN AWWABIM LAUNDRY</h3>

<input id="nama" placeholder="Nama pelanggan">
<input id="driver" placeholder="Nama driver">

<button onclick="simpan('JEMPUT')">ðŸ§º JEMPUT</button>
<button onclick="simpan('ANTAR')" style="margin-top:5px;background:#3498db">ðŸšš ANTAR</button>

<table>
<thead>
<tr><th>Pelanggan</th><th>Driver</th><th>Layanan</th><th>Aksi</th></tr>
</thead>
<tbody id="list"></tbody>
</table>

</div>

<script>
firebase.initializeApp({
 apiKey:"AIzaSyA-1GyDIS77tlL0vpiZS_ZLvx1S71TnkQU",
 databaseURL:"https://awwabim-laundry-default-rtdb.firebaseio.com/"
});

const db = firebase.database().ref("pesanan");
const notif = firebase.database().ref("notifikasi");

/* SIMPAN ORDER */
function simpan(layanan){
 let nama = document.getElementById("nama").value;
 let driver = document.getElementById("driver").value;
 if(!nama || !driver) return alert("Lengkapi data");

 db.push({
  nama, driver, layanan,
  status:"MENUNGGU",
  waktu:Date.now()
 });

 notif.push({
  dari:"ADMIN",
  ke:driver,
  pesan:`Order ${layanan} atas nama ${nama}`,
  waktu:Date.now(),
  dibaca:false
 });

 alert("Order terkirim & driver dinotifikasi");
}

/* LIST */
db.on("value", snap=>{
 let html="";
 snap.forEach(d=>{
  let v=d.val();
  if(v.status==="MENUNGGU"){
   html+=`
   <tr>
    <td>${v.nama}</td>
    <td>${v.driver}</td>
    <td>${v.layanan}</td>
    <td><button onclick="selesai('${d.key}')">SELESAI</button></td>
   </tr>`;
  }
 });
 list.innerHTML=html||"<tr><td colspan=4>Kosong</td></tr>";
});

/* SELESAI */
function selesai(id){
 db.child(id).update({status:"SELESAI"});
}

/* NOTIF DARI DRIVER */
notif.on("child_added", snap=>{
 let n=snap.val();
 if(n.ke==="ADMIN" && !n.dibaca){
  alert("ðŸ”” DRIVER: "+n.pesan);
  snap.ref.update({dibaca:true});
 }
});
</script>
</body>
</html>
